<!doctype html>
<html lang="sv">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
    <title>Spara cash</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.webmanifest" />
    <meta name="theme-color" content="#0ea5e9" />
    <link rel="icon" href="icons/icon-192.png" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <link rel="apple-touch-icon" href="icons/icon-192.png" />

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
      :root{
        /* Palett (accent inspirerad av din logga) */
        --accent:#0f766e;
        --accent-2:#0ea5a3;
        --bg:#f6f8fb;
        --surface:#ffffff;
        --text:#0f172a;
        --muted:#6b7280;
        --border:#e8eaf0;
        --ring:rgba(14,165,233,.18);
        --green:#22c55e;
        --red:#ef4444;
      }

      /* iOS-fixar */
      :root { color-scheme: light; }
      html { -webkit-text-size-adjust: 100%; }

      body{
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        margin:0; color:var(--text); background:var(--bg);
      }

      /* HERO */
      .hero{
        background: radial-gradient(1200px 300px at 30% -10%, #bff0ec 0%, transparent 60%),
                    linear-gradient(135deg, #d8f4f1 0%, #eaf6ff 40%, #f7f9ff 100%);
        padding: max(28px, calc(env(safe-area-inset-top) + 18px)) 0 28px;
        border-bottom: 1px solid var(--border);
      }
      .wrap{ max-width: 820px; margin: 0 auto; padding: 0 22px 28px; }
      .top{
        display:flex; align-items:center; justify-content:space-between; margin-bottom: 14px;
      }
      .brand{
        display:flex; align-items:center; gap:12px;
      }
      .logo{
        width: 38px; height: 38px; border-radius: 12px;
        background: conic-gradient(from 200deg, var(--accent), var(--accent-2));
        box-shadow: 0 6px 18px rgba(15,118,110,.25), inset 0 1px 3px rgba(255,255,255,.6);
      }
      .brand h1{
        font-size: 30px; line-height:1.1; margin:0; letter-spacing:-0.01em;
      }
      .subtitle{
        color:var(--muted); margin:6px 0 0 50px;
      }

      /* Install-knapp */
      .install{
        padding:10px 14px; border-radius: 999px; background:#fff; border:1px solid var(--border);
        box-shadow:0 2px 10px rgba(2,6,23,.06);
        transition: transform .06s ease, box-shadow .18s ease;
      }
      .install:active{ transform: translateY(1px); }
      .install[hidden]{ display:none; }

      /* Innehåll */
      .content{ max-width:820px; margin: 0 auto; padding: 22px; }

      /* Inmatning */
      .row{ display:grid; grid-template-columns: 1fr 160px auto; gap: 10px; margin: 10px 0 18px; }
      @media (max-width: 560px){ .row{ grid-template-columns: 1fr; } }

      input[type="text"], input[type="number"]{
        width:100%; padding: 12px 14px;
        border:1px solid var(--border); border-radius: 12px; background:#fff;
        font-size:17px !important; color:var(--text); caret-color:var(--text);
        outline:none;
        transition: border-color .15s, box-shadow .15s, background-color .15s;
        box-shadow: 0 1px 0 rgba(15,23,42,.03);
      }
      input::placeholder{ color:#9aa0a6; opacity:1; }
      input:focus{ border-color: var(--accent); box-shadow: 0 0 0 4px var(--ring); background:#fff; }

      input:-webkit-autofill{
        -webkit-text-fill-color: var(--text) !important;
        box-shadow: 0 0 0 1000px #fff inset;
        -webkit-box-shadow: 0 0 0 1000px #fff inset;
        caret-color: var(--text);
      }

      .btn{
        padding: 11px 14px; border-radius: 12px; border:1px solid var(--border);
        background:#fff; color:var(--text); cursor:pointer; font-weight:600;
        transition: transform .06s ease, box-shadow .15s, background-color .15s, border-color .15s;
        box-shadow: 0 1px 0 rgba(15,23,42,.05);
      }
      .btn:active{ transform: translateY(1px); }
      .btn-add{
        background: linear-gradient(135deg, var(--accent), var(--accent-2)); color:#fff; border-color:transparent;
        box-shadow: 0 8px 20px rgba(15,118,110,.25);
      }

      /* Cards & listor */
      .card{
        background: var(--surface); border:1px solid var(--border); border-radius: 16px;
        box-shadow: 0 2px 12px rgba(15,23,42,.06);
      }
      .list-item{
        display:flex; align-items:center; justify-content:space-between;
        gap:14px; padding: 14px 16px; border-bottom: 1px solid var(--border);
      }
      .list-item:last-child{ border-bottom: 0; }

      .chip{
        display:inline-block; font-size:12px; padding:6px 10px; border-radius:999px; background:#eef6f6; color:#155e59; font-weight:600;
        border:1px solid #d3ecea;
      }

      .actions{ display:flex; gap: 8px; }
      .save   { background: #22c55e; border-color:#22c55e; color:#fff; }
      .danger { background: #ef4444; border-color:#ef4444; color:#fff; }

      .section{
        display:flex; align-items:center; justify-content:space-between; margin: 22px 0 12px;
      }
      .section h3{ margin:0; font-size: 16px; letter-spacing: .02em; color:#111; }
      .muted{ color:var(--muted); font-style: italic; text-align:center; margin:12px 0; }

      .stats{
        position: sticky; bottom: 0;
        margin-top: 18px; padding: 14px 16px;
        background: var(--surface); border:1px solid var(--border); border-radius: 14px;
        box-shadow: 0 -1px 10px rgba(15,23,42,.06);
      }

      .empty{
        text-align:center; color: var(--muted); padding: 18px 10px;
      }
      .empty b{ color:#0b3; }

      .divider{ height:10px; }

    </style>
  </head>
  <body>
    <header class="hero">
      <div class="wrap">
        <div class="top">
          <div class="brand">
            <div class="logo"></div>
            <h1>Pulsköp</h1>
          </div>
          <button id="installBtn" class="install btn" hidden>Installera appen</button>
        </div>
        <p class="subtitle">Logga impulsköp och markera när du <b>avstod</b>. Allt sparas lokalt på enheten.</p>
      </div>
    </header>

    <main class="content">
      <!-- React mount -->
      <div id="root"></div>
    </main>

    <!-- React via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- App -->
    <script type="text/babel">
      const { useState, useEffect, useMemo } = React;

      const load = (k, f) => { try{ const v = localStorage.getItem(k); return v? JSON.parse(v): f; } catch { return f; } };
      const save = (k, v) => localStorage.setItem(k, JSON.stringify(v));

      function App(){
        const [items, setItems] = useState(() => load("items", []));
        const [saved, setSaved] = useState(() => load("saved", []));
        const [newName, setNewName] = useState("");
        const [newPrice, setNewPrice] = useState("");

        useEffect(() => save("items", items), [items]);
        useEffect(() => save("saved", saved), [saved]);

        const addItem = () => {
          if(!newName.trim() || !newPrice.trim()) { alert("Fyll i både namn och pris"); return; }
          const price = Number(newPrice.replace(",", "."));
          if(Number.isNaN(price) || price <= 0){ alert("Ange ett giltigt pris"); return; }
          setItems(prev => [...prev, { id: String(Date.now()), name: newName.trim(), price }]);
          setNewName(""); setNewPrice("");
        };
        const removeItem = (id) => setItems(prev => prev.filter(i => i.id !== id));
        const saveMoney = (item) => setSaved(prev => [{...item, sid:String(Date.now()), date:new Date().toISOString()}, ...prev]);
        const deleteSaved = (sid) => setSaved(prev => prev.filter(s => s.sid !== sid));
        const clearHistory = () => { if(confirm("Rensa hela historiken?")) setSaved([]); };

        const totalSaved = useMemo(() => saved.reduce((sum,s)=> sum + (Number(s.price)||0), 0), [saved]);

        return (
          <>
            {/* Input row */}
            <div className="row">
              <input type="text" placeholder="Namn (t.ex. Latte)" value={newName} onChange={e=>setNewName(e.target.value)} />
              <input type="number" step="0.01" placeholder="Pris" value={newPrice} onChange={e=>setNewPrice(e.target.value)} />
              <button className="btn btn-add" onClick={addItem}>Lägg till</button>
            </div>

            {/* Möjliga impulsköp */}
            {items.length === 0 && <div className="empty">Inga impulsköp tillagda ännu.</div>}
            {items.length > 0 && (
              <div className="card">
                {items.map(item => (
                  <div className="list-item" key={item.id}>
                    <div>
                      <strong>{item.name}</strong> <span className="chip">{item.price} kr</span>
                    </div>
                    <div className="actions">
                      <button className="btn save" onClick={()=>saveMoney(item)}>Avstod</button>
                      <button className="btn danger" onClick={()=>removeItem(item.id)}>Ta bort</button>
                    </div>
                  </div>
                ))}
              </div>
            )}

            <div className="section">
              <h3>Historik</h3>
              {saved.length > 0 && <button className="btn danger" onClick={clearHistory}>Rensa historik</button>}
            </div>

            {saved.length === 0 && <div className="empty">Du har inte avstått något ännu.</div>}
            {saved.length > 0 && (
              <div className="card">
                {saved.slice(0,100).map(s => (
                  <div className="list-item" key={s.sid}>
                    <div>
                      <strong>{s.name}</strong> <span className="chip">{s.price} kr</span>
                    </div>
                    <div className="actions">
                      <span className="muted" style={{alignSelf:'center'}}>{new Date(s.date).toLocaleString()}</span>
                      <button className="btn danger" onClick={()=>deleteSaved(s.sid)}>Ta bort</button>
                    </div>
                  </div>
                ))}
              </div>
            )}

            <div className="stats"><b>Totalt sparat: {totalSaved.toFixed(2)} kr</b></div>
            <div className="divider"></div>
          </>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);

      // Installationsflöde (PWA)
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        const btn = document.getElementById('installBtn');
        btn.hidden = false;
        btn.onclick = async () => {
          btn.disabled = true;
          await deferredPrompt.prompt();
          await deferredPrompt.userChoice;
          btn.hidden = true;
          deferredPrompt = null;
        };
      });

      // Service worker
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('./service-worker.js');
        });
      }
    </script>
  </body>
</html>
